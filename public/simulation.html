<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Physics Discovery - Simulaci√≥n</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { background: #0a0f1a; color: #fff; font-family: 'Segoe UI', sans-serif; }

        .main { display: flex; height: 100vh; }
        .world { width: 60%; height: 100%; position: relative; }
        #canvas { width: 100%; height: 100%; }

        #panel {
            width: 40%;
            height: 100vh;
            background: linear-gradient(180deg, #0d1520 0%, #0a1018 100%);
            border-left: 2px solid #2050a0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 12px 15px;
            background: #101828;
            border-bottom: 1px solid #203050;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .panel-header h2 { color: #60a0ff; font-size: 14px; font-weight: normal; }
        .panel-header button {
            background: #204080;
            color: #80c0ff;
            border: 1px solid #3060a0;
            padding: 5px 12px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 11px;
            margin-left: 5px;
        }
        .panel-header button:hover { background: #305090; }

        .tabs {
            display: flex;
            background: #0c1220;
            border-bottom: 1px solid #203050;
        }
        .tab {
            padding: 10px 18px;
            cursor: pointer;
            color: #667;
            font-size: 11px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab.active { color: #60a0ff; border-bottom-color: #60a0ff; }
        .tab:hover { color: #80b0ff; }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: none;
        }
        .tab-content.active { display: block; }

        /* Pensamiento */
        .thought-card {
            background: rgba(30, 60, 100, 0.3);
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #4080c0;
        }
        .thought-time { color: #6090c0; font-size: 10px; margin-bottom: 6px; }
        .thought-text { color: #c0d0e0; font-size: 12px; line-height: 1.5; }
        .thought-action {
            margin-top: 8px;
            padding: 6px 10px;
            background: rgba(60, 120, 180, 0.2);
            border-radius: 4px;
            font-size: 11px;
            color: #80c0ff;
        }

        /* Leyes */
        .law-card {
            background: linear-gradient(135deg, rgba(40, 100, 60, 0.4) 0%, rgba(30, 80, 50, 0.3) 100%);
            padding: 14px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid #40c060;
        }
        .law-name { color: #60e080; font-size: 14px; font-weight: bold; margin-bottom: 6px; }
        .law-formula {
            font-family: 'Courier New', monospace;
            color: #a0ffc0;
            font-size: 16px;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin: 8px 0;
        }
        .law-evidence { color: #90c0a0; font-size: 11px; }
        .law-confidence {
            display: inline-block;
            padding: 3px 8px;
            background: rgba(60, 180, 100, 0.3);
            border-radius: 10px;
            font-size: 10px;
            color: #80e0a0;
            margin-top: 6px;
        }

        /* Hip√≥tesis */
        .hypothesis-card {
            background: rgba(100, 80, 40, 0.3);
            padding: 10px;
            margin: 6px 0;
            border-radius: 6px;
            border-left: 3px solid #c0a040;
        }
        .hypothesis-text { color: #e0d0a0; font-size: 12px; }
        .hypothesis-test { color: #a09060; font-size: 10px; margin-top: 4px; font-style: italic; }

        /* Experimentos */
        .exp-card {
            background: rgba(50, 50, 80, 0.3);
            padding: 8px 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 11px;
        }
        .exp-time { color: #6070a0; }
        .exp-action { color: #a0b0e0; font-weight: bold; }
        .exp-result { color: #8090b0; margin-top: 4px; }

        /* HUD */
        #hud {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-70%);
            background: rgba(10, 20, 40, 0.95);
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 13px;
            color: #80c0ff;
            border: 1px solid #304060;
            display: flex;
            gap: 20px;
        }
        .hud-item { display: flex; align-items: center; gap: 6px; }
        .hud-label { color: #5080a0; font-size: 10px; }
        .hud-value { color: #a0d0ff; font-weight: bold; }

        /* Controles */
        #controls {
            position: fixed;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }
        #controls button {
            background: rgba(20, 40, 60, 0.95);
            color: #60a0ff;
            border: 1px solid #305080;
            padding: 8px 14px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 11px;
        }
        #controls button:hover { background: rgba(30, 60, 90, 0.95); }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .stat-box {
            background: rgba(30, 50, 80, 0.4);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number { font-size: 28px; color: #60a0ff; font-weight: bold; }
        .stat-label { font-size: 10px; color: #6080a0; margin-top: 5px; }

        /* Modal Informe */
        #reportModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            overflow-y: auto;
        }
        #reportContent {
            max-width: 900px;
            margin: 30px auto;
            padding: 30px;
            background: #0d1520;
            border: 2px solid #2050a0;
            border-radius: 12px;
        }
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #203050;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        .report-header h1 { color: #60a0ff; font-size: 22px; }
        .report-section {
            background: rgba(20, 40, 70, 0.4);
            padding: 18px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 3px solid #4080c0;
        }
        .report-section h3 { color: #60a0ff; margin-bottom: 12px; font-size: 14px; }
        .report-section p { color: #a0b0c0; font-size: 12px; line-height: 1.6; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a1020; }
        ::-webkit-scrollbar-thumb { background: #304060; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #405080; }
    </style>
</head>
<body>
    <div id="controls">
        <button onclick="sim.reset()">Reset</button>
        <button onclick="sim.generateReport()">INFORME</button>
    </div>

    <div id="hud">
        <div class="hud-item">
            <span class="hud-label">TIEMPO</span>
            <span class="hud-value" id="timeValue">0.0s</span>
        </div>
        <div class="hud-item">
            <span class="hud-label">LEYES</span>
            <span class="hud-value" id="lawsCount">0</span>
        </div>
        <div class="hud-item">
            <span class="hud-label">HIP√ìTESIS</span>
            <span class="hud-value" id="hypCount">0</span>
        </div>
        <div class="hud-item">
            <span class="hud-label">EXPERIMENTOS</span>
            <span class="hud-value" id="expCount">0</span>
        </div>
    </div>

    <div class="main">
        <div class="world">
            <canvas id="canvas"></canvas>
        </div>

        <div id="panel">
            <div class="panel-header">
                <h2>PHYSICS DISCOVERY - DeepSeek AI</h2>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="mind">Pensamiento</div>
                <div class="tab" data-tab="laws">Leyes</div>
                <div class="tab" data-tab="experiments">Experimentos</div>
                <div class="tab" data-tab="stats">Stats</div>
            </div>

            <div id="mind-tab" class="tab-content active"></div>
            <div id="laws-tab" class="tab-content"></div>
            <div id="experiments-tab" class="tab-content"></div>
            <div id="stats-tab" class="tab-content"></div>
        </div>
    </div>

    <div id="reportModal">
        <div id="reportContent"></div>
    </div>

<script>
const WORLD_WIDTH = 1200;
const WORLD_HEIGHT = 400;
const GROUND_Y = 350;

let state = { agent: {x:200,y:0}, objects: [], pendulum: {angle:0}, fluid: {x:700,width:150} };
let laws = { discovered: [], hypotheses: [] };
let thoughts = [];
let experiments = [];

const sim = {
    canvas: null,
    ctx: null,

    init() {
        this.canvas = document.getElementById('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.onresize = () => this.resize();

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
            };
        });

        this.fetchData();
        requestAnimationFrame(() => this.loop());
        setInterval(() => this.fetchData(), 1000);
        setInterval(() => this.updateUI(), 500);
    },

    resize() {
        this.canvas.width = this.canvas.parentElement.clientWidth;
        this.canvas.height = this.canvas.parentElement.clientHeight;
    },

    async fetchData() {
        try {
            const [stateRes, lawsRes, thoughtsRes, expRes] = await Promise.all([
                fetch('/state'),
                fetch('/laws'),
                fetch('/thoughts'),
                fetch('/experiments')
            ]);
            state = await stateRes.json();
            laws = await lawsRes.json();
            thoughts = await thoughtsRes.json();
            experiments = await expRes.json();
        } catch(e) {
            console.error('Fetch error:', e);
        }
    },

    loop() {
        this.render();
        requestAnimationFrame(() => this.loop());
    },

    render() {
        const c = this.ctx;
        const w = this.canvas.width;
        const h = this.canvas.height;

        // Fondo
        const grad = c.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, '#0a1428');
        grad.addColorStop(1, '#051018');
        c.fillStyle = grad;
        c.fillRect(0, 0, w, h);

        // Grid
        c.strokeStyle = 'rgba(40, 80, 120, 0.2)';
        c.lineWidth = 1;
        for(let x = 0; x < w; x += 50) {
            c.beginPath();
            c.moveTo(x, 0);
            c.lineTo(x, h);
            c.stroke();
        }
        for(let y = 0; y < h; y += 50) {
            c.beginPath();
            c.moveTo(0, y);
            c.lineTo(w, y);
            c.stroke();
        }

        const groundY = h - 80;
        const scale = w / WORLD_WIDTH;

        // Suelo
        c.fillStyle = '#1a2840';
        c.fillRect(0, groundY, w, h - groundY);
        c.strokeStyle = '#3060a0';
        c.lineWidth = 2;
        c.beginPath();
        c.moveTo(0, groundY);
        c.lineTo(w, groundY);
        c.stroke();

        // Tanque de agua
        const fluidX = state.fluid?.x * scale || 700;
        const fluidW = (state.fluid?.width || 150) * scale;
        c.fillStyle = 'rgba(40, 120, 200, 0.4)';
        c.fillRect(fluidX, groundY - 80, fluidW, 80);
        c.strokeStyle = 'rgba(60, 150, 255, 0.6)';
        c.strokeRect(fluidX, groundY - 80, fluidW, 80);
        c.fillStyle = '#4090d0';
        c.font = '11px sans-serif';
        c.textAlign = 'center';
        c.fillText('AGUA (œÅ=1000 kg/m¬≥)', fluidX + fluidW/2, groundY - 85);

        // P√©ndulo
        if(state.pendulum) {
            const pivotX = 350 * scale;
            const pivotY = h * 0.3;
            const L = 120;
            const angle = (state.pendulum.angle || 0) * Math.PI / 180;
            const bobX = pivotX + Math.sin(angle) * L;
            const bobY = pivotY + Math.cos(angle) * L;

            // Soporte
            c.fillStyle = '#405060';
            c.fillRect(pivotX - 30, pivotY - 10, 60, 10);

            // Cuerda
            c.strokeStyle = '#606060';
            c.lineWidth = 2;
            c.beginPath();
            c.moveTo(pivotX, pivotY);
            c.lineTo(bobX, bobY);
            c.stroke();

            // Bola
            c.fillStyle = '#c08040';
            c.beginPath();
            c.arc(bobX, bobY, 15, 0, Math.PI * 2);
            c.fill();

            c.fillStyle = '#c0a060';
            c.font = '10px sans-serif';
            c.textAlign = 'center';
            c.fillText(`Œ∏=${(state.pendulum.angle || 0).toFixed(1)}¬∞`, pivotX, pivotY - 20);
            c.fillText(`L=${state.pendulum.length || 2}m`, pivotX, pivotY - 8);
        }

        // Objetos
        for(const obj of state.objects || []) {
            if(obj.held) continue;

            const ox = obj.x * scale;
            const oy = groundY - 20 - obj.y * 3;

            // Sombra
            c.fillStyle = 'rgba(0,0,0,0.3)';
            c.beginPath();
            c.ellipse(ox, groundY - 2, 12, 4, 0, 0, Math.PI * 2);
            c.fill();

            // Objeto
            c.fillStyle = obj.color || '#808080';
            c.beginPath();
            c.arc(ox, oy, (obj.radius || 15) * 0.8, 0, Math.PI * 2);
            c.fill();

            // Etiqueta
            c.fillStyle = '#a0c0e0';
            c.font = '9px sans-serif';
            c.textAlign = 'center';
            c.fillText(obj.id, ox, oy - 20);
            c.fillStyle = '#6090b0';
            c.fillText(`${obj.mass}kg`, ox, oy - 10);
        }

        // Agente
        if(state.agent) {
            const ax = state.agent.x * scale;
            const ay = groundY - 50 - (state.agent.y || 0) * 3;

            // Sombra
            c.fillStyle = 'rgba(0,0,0,0.4)';
            c.beginPath();
            c.ellipse(ax, groundY - 3, 18, 5, 0, 0, Math.PI * 2);
            c.fill();

            // Cuerpo
            c.fillStyle = '#3080c0';
            c.fillRect(ax - 12, ay + 15, 24, 35);

            // Cabeza
            c.fillStyle = '#50a0e0';
            c.beginPath();
            c.arc(ax, ay, 15, 0, Math.PI * 2);
            c.fill();

            // Ojos
            c.fillStyle = '#fff';
            c.beginPath();
            c.arc(ax - 5, ay - 2, 4, 0, Math.PI * 2);
            c.arc(ax + 5, ay - 2, 4, 0, Math.PI * 2);
            c.fill();

            c.fillStyle = '#000';
            c.beginPath();
            c.arc(ax - 4, ay - 2, 2, 0, Math.PI * 2);
            c.arc(ax + 6, ay - 2, 2, 0, Math.PI * 2);
            c.fill();

            // Etiqueta
            c.fillStyle = '#60c0ff';
            c.font = 'bold 12px sans-serif';
            c.textAlign = 'center';
            c.fillText('AI PHYSICIST', ax, ay - 25);

            // Objeto sostenido
            if(state.agent.holding) {
                c.fillStyle = '#ff8060';
                c.beginPath();
                c.arc(ax + 20, ay + 10, 10, 0, Math.PI * 2);
                c.fill();
                c.fillStyle = '#ffa080';
                c.font = '8px sans-serif';
                c.fillText(state.agent.holding, ax + 20, ay + 25);
            }
        }

        // Escala
        c.fillStyle = '#4080a0';
        c.font = '10px monospace';
        c.textAlign = 'left';
        c.fillText('0m', 10, groundY + 15);
        c.fillText(`${Math.round(WORLD_WIDTH/100)}m`, w - 30, groundY + 15);

        // Tiempo
        c.fillStyle = '#60a0ff';
        c.font = 'bold 14px sans-serif';
        c.textAlign = 'right';
        c.fillText(`t = ${(state.time || 0).toFixed(2)}s`, w - 15, 25);
    },

    updateUI() {
        // HUD
        document.getElementById('timeValue').textContent = (state.time || 0).toFixed(1) + 's';
        document.getElementById('lawsCount').textContent = (laws.discovered || []).length;
        document.getElementById('hypCount').textContent = (laws.hypotheses || []).length;
        document.getElementById('expCount').textContent = experiments.length;

        // Tab Pensamiento
        const mindTab = document.getElementById('mind-tab');
        mindTab.innerHTML = thoughts.slice().reverse().map(t => `
            <div class="thought-card">
                <div class="thought-time">t = ${(t.time || 0).toFixed(1)}s</div>
                <div class="thought-text">${t.thinking || '...'}</div>
                ${t.action ? `<div class="thought-action">‚ö° ${t.action.action || t.action.type || 'WAIT'}</div>` : ''}
                ${t.hypothesis ? `<div style="color:#e0c060;font-size:11px;margin-top:6px;">üìä Hip√≥tesis: ${t.hypothesis.description}</div>` : ''}
                ${t.discovery ? `<div style="color:#60e080;font-size:11px;margin-top:6px;">üéâ ¬°Descubrimiento! ${t.discovery.name}</div>` : ''}
            </div>
        `).join('') || '<p style="color:#667;text-align:center;padding:20px;">Esperando pensamientos...</p>';

        // Tab Leyes
        const lawsTab = document.getElementById('laws-tab');
        const discoveredHtml = (laws.discovered || []).map(l => `
            <div class="law-card">
                <div class="law-name">‚úì ${l.name}</div>
                <div class="law-formula">${l.formula}</div>
                <div class="law-evidence">${l.evidence}</div>
                <span class="law-confidence">${l.confidence}% confianza</span>
            </div>
        `).join('');

        const hypothesesHtml = (laws.hypotheses || []).map(h => `
            <div class="hypothesis-card">
                <div class="hypothesis-text">? ${h.description}</div>
                ${h.test ? `<div class="hypothesis-test">Test: ${h.test}</div>` : ''}
            </div>
        `).join('');

        lawsTab.innerHTML = `
            <h3 style="color:#40c060;margin-bottom:15px;">Leyes Descubiertas (${(laws.discovered || []).length})</h3>
            ${discoveredHtml || '<p style="color:#556;padding:10px;">Ninguna ley descubierta a√∫n...</p>'}
            <h3 style="color:#c0a040;margin:20px 0 15px;">Hip√≥tesis (${(laws.hypotheses || []).length})</h3>
            ${hypothesesHtml || '<p style="color:#556;padding:10px;">Ninguna hip√≥tesis formada...</p>'}
        `;

        // Tab Experimentos
        const expTab = document.getElementById('experiments-tab');
        expTab.innerHTML = experiments.slice().reverse().slice(0, 30).map(e => `
            <div class="exp-card">
                <span class="exp-time">[t=${(e.time || 0).toFixed(1)}s]</span>
                <span class="exp-action">${e.action?.type || 'UNKNOWN'}</span>
                <div class="exp-result">${e.observation}</div>
            </div>
        `).join('') || '<p style="color:#667;text-align:center;padding:20px;">Sin experimentos...</p>';

        // Tab Stats
        const statsTab = document.getElementById('stats-tab');
        statsTab.innerHTML = `
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number">${(state.time || 0).toFixed(0)}s</div>
                    <div class="stat-label">TIEMPO SIMULADO</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${(laws.discovered || []).length}/7</div>
                    <div class="stat-label">LEYES DESCUBIERTAS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${experiments.length}</div>
                    <div class="stat-label">EXPERIMENTOS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${(laws.hypotheses || []).length}</div>
                    <div class="stat-label">HIP√ìTESIS</div>
                </div>
            </div>
            <div class="stat-box" style="margin-top:15px;">
                <div style="color:#6090b0;font-size:12px;text-align:left;">
                    <p><strong>Objetos:</strong> ${(state.objects || []).length}</p>
                    <p><strong>Agente en:</strong> (${Math.round(state.agent?.x || 0)}, ${Math.round((state.agent?.y || 0) * 10) / 10})m</p>
                    <p><strong>Sosteniendo:</strong> ${state.agent?.holding || 'nada'}</p>
                </div>
            </div>
            <div style="margin-top:20px;padding:15px;background:rgba(40,80,60,0.3);border-radius:8px;">
                <h4 style="color:#60c080;margin-bottom:10px;">Leyes a Descubrir</h4>
                <ul style="color:#80a090;font-size:11px;padding-left:20px;">
                    <li>Gravedad (g ‚âà 9.81 m/s¬≤)</li>
                    <li>Segunda ley de Newton (F = ma)</li>
                    <li>Fricci√≥n (Œº variable)</li>
                    <li>Per√≠odo del p√©ndulo (T = 2œÄ‚àöL/g)</li>
                    <li>Principio de Arqu√≠medes</li>
                    <li>Conservaci√≥n del momento</li>
                    <li>Movimiento parab√≥lico</li>
                </ul>
            </div>
        `;
    },

    async reset() {
        await fetch('/reset', { method: 'POST' });
        await this.fetchData();
    },

    async generateReport() {
        try {
            const res = await fetch('/report');
            const report = await res.json();

            const html = `
                <div class="report-header">
                    <h1>üìä INFORME DE DESCUBRIMIENTO F√çSICO</h1>
                    <button onclick="document.getElementById('reportModal').style.display='none'"
                            style="background:#c04040;color:#fff;border:none;padding:10px 20px;cursor:pointer;border-radius:5px;">
                        Cerrar
                    </button>
                </div>

                <div class="report-section">
                    <h3>üìà RESUMEN</h3>
                    <p><strong>Tiempo simulado:</strong> ${report.summary.simulationTime.toFixed(1)}s</p>
                    <p><strong>Leyes descubiertas:</strong> ${report.summary.lawsDiscovered} / 7</p>
                    <p><strong>Hip√≥tesis formadas:</strong> ${report.summary.hypothesesFormed}</p>
                    <p><strong>Experimentos realizados:</strong> ${report.summary.experimentsRun}</p>
                    <p><strong>Mediciones tomadas:</strong> ${report.summary.measurementsTaken}</p>
                </div>

                <div class="report-section">
                    <h3>‚úì LEYES DESCUBIERTAS</h3>
                    ${report.discoveredLaws.length === 0 ? '<p>Ninguna ley descubierta a√∫n.</p>' :
                      report.discoveredLaws.map(l => `
                        <div style="background:rgba(40,100,60,0.3);padding:12px;margin:10px 0;border-radius:6px;">
                            <strong style="color:#60e080;">${l.name}</strong>
                            <div style="font-family:monospace;color:#a0ffc0;margin:8px 0;font-size:16px;">${l.formula}</div>
                            <p style="color:#90c0a0;font-size:11px;">${l.evidence}</p>
                            <span style="background:rgba(60,180,100,0.3);padding:3px 8px;border-radius:10px;font-size:10px;color:#80e0a0;">
                                ${l.confidence}% confianza
                            </span>
                        </div>
                    `).join('')}
                </div>

                <div class="report-section">
                    <h3>? HIP√ìTESIS</h3>
                    ${report.hypotheses.length === 0 ? '<p>Ninguna hip√≥tesis formada.</p>' :
                      report.hypotheses.map(h => `
                        <div style="background:rgba(100,80,40,0.3);padding:10px;margin:8px 0;border-radius:6px;">
                            <p style="color:#e0d0a0;">${h.description}</p>
                            ${h.test ? `<p style="color:#a09060;font-size:10px;font-style:italic;">Test: ${h.test}</p>` : ''}
                        </div>
                    `).join('')}
                </div>

                <div class="report-section">
                    <h3>üß† PROCESO DE PENSAMIENTO</h3>
                    ${report.thoughtProcess.map(t => `
                        <div style="padding:8px;margin:5px 0;border-left:2px solid #4080c0;padding-left:12px;">
                            <span style="color:#6090c0;font-size:10px;">[t=${t.time.toFixed(1)}s]</span>
                            <span style="color:#80c0ff;font-size:11px;">${t.action || 'THINK'}</span>
                            <p style="color:#a0b0c0;font-size:11px;margin-top:4px;">${t.thinking?.substring(0, 150)}...</p>
                        </div>
                    `).join('')}
                </div>

                <div class="report-section">
                    <h3>üìã MEDICIONES RECIENTES</h3>
                    <div style="max-height:200px;overflow-y:auto;">
                    ${report.measurements.map(m => `
                        <div style="font-size:10px;color:#8090b0;padding:4px 0;border-bottom:1px solid rgba(60,80,120,0.3);">
                            ${m.type}: ${m.object || ''} ${m.type === 'push' ? `F=${m.force}N m=${m.mass}kg a=${m.acceleration?.toFixed(2)}m/s¬≤` : ''}
                            ${m.type === 'drop' ? `h=${m.startY?.toFixed(1)}m` : ''}
                            ${m.type === 'throw' ? `v=(${m.vx0?.toFixed(1)},${m.vy0?.toFixed(1)})m/s` : ''}
                        </div>
                    `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = html;
            document.getElementById('reportModal').style.display = 'block';
        } catch(e) {
            console.error('Error generating report:', e);
            alert('Error generando informe');
        }
    }
};

window.onload = () => sim.init();
</script>
</body>
</html>
